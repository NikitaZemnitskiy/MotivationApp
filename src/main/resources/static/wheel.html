<!doctype html>
<html lang="ru">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>–†—É–ª–µ—Ç–∫–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .btn{
            padding:.5rem .75rem;
            background:rgba(236,72,153,0.2);
            border:1px solid rgba(236,72,153,0.5);
            border-radius:.75rem;
            transition:all .25s ease;
        }
        .btn:hover{transform:translateY(-1px);}
        .btn[disabled]{opacity:.6;filter:grayscale(.4);cursor:not-allowed;transform:none;}
        #wheel{
            position:relative;
            background:
                    conic-gradient(
                            #ec4899 0 40%,
                            #eab308 40% 70%,
                            #3b82f6 70% 80%,
                            #22c55e 80% 90%,
                            #f43f5e 90% 100%
                    ),
                    radial-gradient(circle at center,rgba(255,255,255,.05)0 60%,rgba(0,0,0,.5)61%100%);
            box-shadow:inset 0 0 30px rgba(0,0,0,.6),0 0 15px rgba(236,72,153,.6);
            transform:rotate(0deg);
            transition:transform 2s cubic-bezier(.2,.8,.3,1.4);
        }
        #wheel .slice{
            position:absolute;
            left:50%;top:50%;
            transform-origin:0 0;
            transform:rotate(var(--rot)) translateY(-100px) rotate(calc(-1*var(--rot)));
            font-size:1.5rem;pointer-events:none;
        }
    </style>
</head>
<body class="bg-slate-950 text-slate-100 flex items-center justify-center min-h-screen">
<div class="w-full max-w-md p-4 text-center">
    <div class="relative mx-auto my-4">
        <div id="wheel" class="w-64 h-64 rounded-full border-4 border-pink-500/50 overflow-hidden">
            <div class="slice" style="--rot:72deg">‚ö°</div>
            <div class="slice" style="--rot:198deg">üåü</div>
            <div class="slice" style="--rot:270deg">üéÅ</div>
            <div class="slice" style="--rot:306deg">üí∞</div>
            <div class="slice" style="--rot:342deg">üéâ</div>
        </div>
        <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
            <div class="w-0 h-0 border-l-8 border-r-8 border-b-[18px] border-transparent border-b-amber-400 -mt-64"></div>
        </div>
    </div>

    <div id="wheelMsg" class="text-sm opacity-80 min-h-[2rem]"></div>
    <div class="flex justify-center gap-2 mt-3">
        <button id="spinBtn" class="btn">–ö—Ä—É—Ç–∏—Ç—å</button>
        <button class="btn" onclick="window.location.href='index.html'">–ù–∞–∑–∞–¥</button>
    </div>
    <div id="wheelNext" class="text-xs opacity-60 mt-3"></div>
</div>

<script>
    const $ = sel => document.querySelector(sel);

    async function api(url, opts={}) {
        const r = await fetch(url, opts);
        if (!r.ok) throw new Error('HTTP '+r.status);
        return r.json();
    }

    let rotation = 0;

    async function loadWheel(){
        const j = await api('/api/roulette/today');
        $('#wheelMsg').textContent = j.message || '';
        $('#spinBtn').disabled = !j.canSpin;
        updateNextSpin(j.canSpin ? null : j.nextSpinAt);
    }

    async function spinWheel(){
        const wheel = $('#wheel');
        const extra = 360*5 + Math.floor(Math.random()*360);
        rotation += extra;
        wheel.style.transform = `rotate(${rotation}deg)`;
        const j = await api('/api/roulette/spin', {method:'POST'});
        $('#wheelMsg').textContent = j.message || '';
        $('#spinBtn').disabled = true;
        updateNextSpin(j.nextSpinAt);
    }

    let timer;
    function updateNextSpin(iso){
        clearInterval(timer);
        const el = $('#wheelNext');
        if(!iso){ el.textContent=''; return; }
        function tick(){
            const diff = new Date(iso) - new Date();
            if(diff <= 0){ el.textContent=''; clearInterval(timer); return; }
            const h=Math.floor(diff/3600000),
                m=Math.floor(diff%3600000/60000),
                s=Math.floor(diff%60000/1000);
            el.textContent=`–°–ª–µ–¥—É—é—â–∞—è —Ä—É–ª–µ—Ç–∫–∞ —á–µ—Ä–µ–∑ ${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
        }
        tick(); timer=setInterval(tick,1000);
    }

    $('#spinBtn').addEventListener('click', spinWheel);
    loadWheel();
</script>

</body>
</html>
